<?xml version="1.0"?>

<project name="genedb-domain" default="domain-fulljar" basedir=".">

  <dirname property="imported.basedir.domain" file="${ant.file.genedb-domain}"/>

  <property name="lib-dir" value="${imported.basedir.domain}/../genedb-libs/lib/"/>

  <import file="${imported.basedir.domain}/../genedb-libs/build.xml"  />
  <import file="${imported.basedir.domain}/../genedb-db/build.xml"    />
  <import file="${imported.basedir.domain}/../genedb-query/build.xml" />
  <import file="${imported.basedir.domain}/../genedb-util/build.xml"  />

  <property name="genedb-domain.jar"
      value="${imported.basedir.domain}/${dist.dir}/genedb-domain.jar"/>

  <path id="domain-classpath">
    <fileset dir="${imported.basedir.domain}/lib">
      <include name="*.jar"/>
    </fileset>
    <pathelement location="${lib-dir}/biojava/biojava-1.6.jar"/>
  </path>

  <path id="domain-tests-classpath">
    <path refid="domain-classpath"/>
    <pathelement location="${imported.basedir.domain}/${classes.dir}"/>
    <pathelement location="${imported.basedir.domain}/${test-classes.dir}"/>
    <pathelement location="${imported.basedir.domain}/test"/>
  </path>

<!--
<target name="fulljar-domain" depends="genedb-db.fulljar-db,genedb-query.fulljar-query,genedb-util.fulljar-util"
          description="Create full JAR file with all Spring classes">
    <init-target project="domain"/>
    <compile-target project="domain"/>
    <jar-target project="domain"/>
  </target>
-->

  <target name="check.domain-lib-uptodate" depends="init-domain">
    <uptodate property="domain.lib-uptodate" srcfile="${imported.basedir.domain}/ivy.xml" targetfile="${imported.basedir.domain}/lib/ivy.timestamp.txt" />
  </target>

  <target name="init-domain" description="Create full JAR file">
    <init-target project="domain" />
  </target>

  <target name="domain-populate-lib" depends="check.domain-lib-uptodate" unless="domain.lib-uptodate">
    <populate directory="genedb-domain" />
    <copy todir="lib">
        <fileset dir="${imported.basedir.libs}/lib/biojava">
            <include name="biojava-1.6.jar"/>
            <include name="bytecode-0.91.jar"/>
        </fileset>
    </copy>
  </target>

  <target name="domain-compile" depends="domain-populate-lib, domain-populate-util, domain-populate-query, domain-populate-db" description="Compile">
    <compile-target project="domain" />
    <uptodate property="domain.jar-uptodate" targetfile="${imported.basedir.domain}/ant-build/dist/genedb-domain.jar">
      <srcfiles dir="${imported.basedir.domain}/${classes.dir}" />
    </uptodate>
  </target>

  <target name="domain-fulljar" depends="domain-compile" description="Create full JAR file" unless="domain.jar-uptodate">
    <jar-target project="domain" />
  </target>

  <target name="domain-populate-util" depends="util-fulljar">
    <copy file="${genedb-util.jar}" todir="${imported.basedir.domain}/lib" />
  </target>


  <target name="domain-populate-query" depends="query-fulljar">
    <copy file="${genedb-query.jar}" todir="${imported.basedir.domain}/lib" />
  </target>


  <target name="domain-populate-db" depends="db-fulljar">
    <copy file="${genedb-db.jar}" todir="${imported.basedir.domain}/lib" />
  </target>

  <!--target name="compile-tests">
      <javac srcdir="${imported.basedir.domain}/test" includes="**/*.java"
                 destdir="${imported.basedir.domain}/${test-classes.dir}"
                 classpathref="domain-classpath" />
  </target-->

  <target name="genedb-domain-tests" depends="domain-compile">
    <tests-target project="domain"/>
  </target>

  <target name="domain-clean">
    <clean-target project="domain" />
  </target>

</project>
